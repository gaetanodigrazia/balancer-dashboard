<h2>Scorte attuali</h2>

<div *ngIf="loading">Caricamento...</div>
<div *ngIf="error" style="color: red;">⚠️ {{ error }}</div>

<!-- Form inserimento prodotto -->
<form (submit)="aggiungiProdotto(); $event.preventDefault()" style="margin-bottom:20px;">
  <div>
    <label for="nome">Nome Prodotto:</label><br />
    <input
      id="nome"
      type="text"
      placeholder="Es. Latte intero"
      [(ngModel)]="nuovoProdotto.nome"
      name="nome"
      required
      autocomplete="off"
    />
  </div>

  <div>
    <label for="quantita">Quantità (pezzi):</label><br />
    <input
      id="quantita"
      type="number"
      placeholder="Es. 3"
      [(ngModel)]="nuovoProdotto.quantita"
      name="quantita"
      required
      min="1"
    />
  </div>

  <div>
    <label for="quantita_grammi">Quantità (grammi):</label><br />
    <input
      id="quantita_grammi"
      type="number"
      placeholder="Es. 200"
      [(ngModel)]="nuovoProdotto.quantita_grammi"
      name="quantita_grammi"
      min="0"
      step="any"
    />
  </div>

  <div>
    <label for="prezzo_unitario">Prezzo unitario (€):</label><br />
    <input
      id="prezzo_unitario"
      type="number"
      placeholder="Es. 1.50"
      [(ngModel)]="nuovoProdotto.prezzo_unitario"
      name="prezzo_unitario"
      required
      step="0.01"
      min="0"
    />
  </div>

  <button type="submit" style="margin-top:10px;">Aggiungi Prodotto</button>
</form>

<table *ngIf="!loading && !error && scorte.length > 0" border="1" cellpadding="6">
  <thead>
    <tr>
      <th>Nome</th>
      <th>Quantità Totale (pezzi)</th>
      <th>Quantità Totale (grammi)</th>
      <th>Prezzo Unitario Medio (€)</th>
      <th>ID Scontrini Associati</th>
      <th>Azioni</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let prodotto of scorte; let i = index">
      <td>{{ prodotto.nome }}</td>
      <td>
        <input
          type="number"
          [value]="prodotto.quantita"
          (input)="prodotto.quantita = $event.target.valueAsNumber"
          min="0"
        />
      </td>
      <td>
        <input
          type="number"
          [value]="prodotto.quantita_grammi"
          (input)="prodotto.quantita_grammi = $event.target.valueAsNumber"
          min="0"
          step="0.01"
        />
      </td>
      <td>{{ prodotto.prezzo_unitario | number:'1.2-2' }}</td>
      <td>{{ prodotto.scontrino_ids.join(', ') }}</td>
      <td>
        <button (click)="salvaQuantitaAggiornata(prodotto)" style="margin-right: 0.5rem;">
          Salva
        </button>
        <button
          (click)="rimuoviProdotto(prodotto.id)"
          style="color: #d32f2f; border:none; background:none; cursor:pointer;"
        >
          Rimuovi
        </button>
      </td>
    </tr>
  </tbody>
</table>



<div *ngIf="!loading && !error && scorte.length === 0">
  Nessun prodotto presente nelle scorte.
</div>
